:root {
      --bg: #020617;
      --bg-alt: #020617;
      --bg-card: #020617;
      --bg-elevated: #020617;
      --border-subtle: rgba(148, 163, 184, 0.25);
      --accent: #e11d48;
      --accent-soft: rgba(248, 113, 113, 0.12);
      --accent-strong: #f97316;
      --accent-muted: #facc15;
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --text-strong: #f9fafb;
      --danger: #ef4444;
      --success: #22c55e;
      --warning: #f59e0b;
      --muted-bg: rgba(15, 23, 42, 0.88);
      --card-radius: 14px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.65);
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #111827, #020617 54%);
      color: var(--text-main);
    }

    body {
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app {
      width: 100%;
      max-width: 1120px;
      padding: 12px 10px 24px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    header.topbar {
      background: linear-gradient(120deg, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.96));
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      padding: 10px 16px;
      gap: 12px;
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(18px);
    }

    .brand-chunk {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 10%, #f97316, #dc2626 60%, #111827 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 1px rgba(248, 250, 252, 0.2),
        0 12px 20px rgba(0, 0, 0, 0.6);
    }

    .brand-logo svg {
      width: 22px;
      height: 22px;
      fill: #fefce8;
      filter: drop-shadow(0 0 6px rgba(248, 250, 252, 0.65));
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-title {
      font-weight: 700;
      letter-spacing: 0.02em;
      color: var(--text-strong);
      font-size: 1.15rem;
    }

    .brand-sub {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .top-stats {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .pill {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 0.8rem;
      min-width: 0;
    }

    .pill.accent {
      background: radial-gradient(circle at 0 0, rgba(248, 250, 252, 0.12), rgba(15, 23, 42, 0.95));
      border-color: rgba(248, 113, 113, 0.8);
    }

    .pill strong {
      color: var(--text-strong);
      font-weight: 700;
      font-size: 0.85rem;
    }

    .pill small {
      color: var(--text-soft);
      font-size: 0.75rem;
      display: block;
    }

    .pill .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 12px #22c55e;
      flex-shrink: 0;
    }

    main.layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
      gap: 12px;
      align-items: flex-start;
    }

    .column {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.98));
      border-radius: var(--card-radius);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      overflow: hidden;
    }

    .card-header {
      padding: 10px 12px 8px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .card-title {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-strong);
    }

    .card-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.78rem;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.35);
      color: var(--text-soft);
    }

    .card-pill .icon {
      width: 14px;
      height: 14px;
      fill: #f97316;
    }

    .card-body {
      padding: 10px 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .subheading {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--accent-muted);
      margin-bottom: 6px;
    }

    .stat-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .stat {
      flex: 1 1 90px;
      min-width: 0;
    }

    .stat .label {
      display: block;
      font-size: 0.72rem;
      color: var(--text-soft);
      margin-bottom: 2px;
    }

    .stat .value {
      font-size: 0.96rem;
      font-weight: 600;
      color: var(--text-strong);
    }

    .inventory-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 8px;
    }

    .chip {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 8px 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .chip-main {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      font-size: 0.88rem;
      color: var(--text-strong);
    }

    .chip-main span {
      font-weight: 600;
    }

    .chip-sub {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 0.76rem;
      color: var(--text-soft);
    }

    .chip-sub > div {
      display: flex;
      gap: 4px;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid transparent;
      font-size: 0.78rem;
      padding: 4px 10px;
      cursor: pointer;
      transition: background 0.15s ease, border-color 0.15s ease,
        transform 0.08s ease;
      background: rgba(15, 23, 42, 0.85);
      color: var(--text-main);
    }

    .btn.primary {
      background: linear-gradient(135deg, #fb923c, #f97316);
      color: #111827;
      border-color: rgba(248, 250, 252, 0.3);
      box-shadow: 0 8px 18px rgba(248, 113, 113, 0.25);
    }

    .btn.primary:hover {
      background: linear-gradient(135deg, #fdba74, #fb923c);
      transform: translateY(-1px);
    }

    .btn.ghost {
      border-color: rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.8);
      color: var(--text-soft);
    }

    .btn.ghost:hover {
      background: rgba(30, 64, 175, 0.4);
      border-color: rgba(59, 130, 246, 0.7);
    }

    .btn.danger {
      background: radial-gradient(circle at top left, #f97316, #ef4444);
      border-color: rgba(254, 226, 226, 0.4);
      color: #111827;
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.35);
    }

    .btn.danger:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: default;
      transform: none;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.7rem;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-soft);
    }

    .badge.warn {
      border-color: rgba(245, 158, 11, 0.8);
      background: rgba(30, 64, 175, 0.9);
      color: #fde68a;
    }

    .flavors-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .flavor-pill {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 4px 9px;
      font-size: 0.75rem;
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      transition: background 0.15s ease, border-color 0.15s ease,
        transform 0.08s ease;
    }

    .flavor-pill .dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #f97316;
      box-shadow: 0 0 6px rgba(234, 179, 8, 0.8);
    }

    .flavor-pill.active {
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(249, 115, 22, 0.32));
      border-color: rgba(249, 115, 22, 0.9);
      color: #fed7aa;
    }

    .flavor-pill.locked {
      opacity: 0.5;
      border-style: dashed;
      cursor: not-allowed;
    }

    .range-wrap {
      flex: 1 1 auto;
      max-width: 260px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .price-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    input[type="range"] {
      width: 100%;
      -webkit-appearance: none;
      background: transparent;
    }

    input[type="range"]::-webkit-slider-runnable-track {
      height: 4px;
      background: linear-gradient(90deg, #22c55e, #facc15, #ef4444);
      border-radius: 999px;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: #f9fafb;
      border: 2px solid #f97316;
      margin-top: -5px;
      box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.9);
    }

    input[type="range"]::-moz-range-track {
      height: 4px;
      background: linear-gradient(90deg, #22c55e, #facc15, #ef4444);
      border-radius: 999px;
    }

    input[type="range"]::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: #f9fafb;
      border: 2px solid #f97316;
      box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.9);
    }

    .upgrades-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .upgrade {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(15, 23, 42, 0.92);
    }

    .upgrade h4 {
      margin: 0 0 4px;
      font-size: 0.85rem;
      color: var(--text-strong);
    }

    .upgrade p {
      margin: 0 0 4px;
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .upgrade small {
      display: block;
      font-size: 0.7rem;
      color: rgba(248, 250, 252, 0.8);
      margin-bottom: 2px;
    }

    .upgrade .tag {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.68rem;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--text-soft);
    }

    .upgrade.purchased {
      opacity: 0.6;
      background: rgba(15, 23, 42, 0.8);
    }

    .achievements-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .achievement {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.45);
      color: var(--text-soft);
      background: rgba(15, 23, 42, 0.85);
    }

    .achievement.unlocked {
      border-style: solid;
      border-color: rgba(52, 211, 153, 0.9);
      background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.18), rgba(15, 23, 42, 0.95));
      color: #bbf7d0;
    }

    .log {
      max-height: 260px;
      min-height: 160px;
      overflow-y: auto;
      padding-right: 2px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .log-entry {
      font-size: 0.74rem;
      padding: 4px 6px;
      border-radius: 8px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-soft);
    }

    .log-entry.good {
      border-color: rgba(34, 197, 94, 0.7);
      color: #bbf7d0;
    }

    .log-entry.bad {
      border-color: rgba(248, 113, 113, 0.8);
      color: #fecaca;
    }

    .footer-note {
      font-size: 0.75rem;
      color: var(--text-soft);
      text-align: right;
      padding: 0 4px;
      margin-top: 2px;
    }

    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    /* Adventure box (right column) */
    #adventureBox {
      min-height: 52px;
    }

    /* Global event popup */

    .hidden {
      display: none !important;
    }

    #eventPopup {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 80px 16px 16px;
      background: rgba(15, 23, 42, 0.75);
      backdrop-filter: blur(10px);
      z-index: 40;
    }

    .event-popup-panel {
      width: 100%;
      max-width: 420px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.98));
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      box-shadow: 0 24px 50px rgba(15, 23, 42, 0.9);
      padding: 10px 12px 12px;
    }

    .event-popup-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 4px;
    }

    .event-popup-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-strong);
    }

    .event-popup-tag {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.45);
      color: var(--accent-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .event-popup-body {
      font-size: 0.8rem;
      color: var(--text-main);
      margin-bottom: 8px;
    }

    .event-popup-footer {
      display: flex;
      justify-content: flex-end;
      gap: 6px;
    }

    .event-popup-footer .btn {
      font-size: 0.78rem;
      padding-inline: 12px;
    }

    @media (max-width: 900px) {
      main.layout {
        grid-template-columns: minmax(0, 1fr);
      }

      header.topbar {
        position: static;
      }

      .card {
        border-radius: 16px;
      }

      #eventPopup {
        padding-top: 60px;
      }
    }

    @media (max-width: 640px) {
      .app {
        padding-inline: 8px;
      }

      header.topbar {
        padding: 8px 10px;
      }

      .card-header {
        padding-inline: 10px;
      }

      .card-body {
        padding-inline: 10px;
      }

      .event-popup-panel {
        max-width: 100%;
      }
    }